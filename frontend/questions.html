<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Questions</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
  body {
    margin: 0;
    font-family: "Inter", sans-serif;
    background: linear-gradient(135deg, #0f172a, #1e293b, #0b132b);
    color: white;
    padding: 40px;
  }
  h1 { text-align: center; margin-bottom: 30px; color: #38bdf8; font-size: 32px; }
  .container { width: 90%; max-width: 900px; margin: auto; }
  .card { background: rgba(255,255,255,0.12); padding: 25px; border-radius: 14px; backdrop-filter: blur(10px); margin-bottom: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
  label { font-weight: 500; }
  input { width: 100%; padding: 14px; border-radius: 8px; border: none; margin-top: 6px; margin-bottom: 15px; background: #e2e8f0; font-size: 15px; }
  button { width: 100%; padding: 14px; background: #38bdf8; border: none; font-size: 16px; font-weight: 600; border-radius: 8px; color: #0f172a; cursor: pointer; transition: .3s; }
  button:hover { background: #0ea5e9; transform: translateY(-3px); }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.15); }
  th { color: #38bdf8; font-size: 17px; }
  .btn-small { padding: 6px 10px; font-size: 14px; border-radius: 5px; margin-right: 6px; cursor: pointer; transition: .2s; }
  .edit-btn { background: #facc15; color: black; }
  .edit-btn:hover { background: #eab308; }
  .delete-btn { background: #ef4444; color: white; }
  .delete-btn:hover { background: #dc2626; }
  #toast { position: fixed; top: 20px; right: -300px; background: #22c55e; padding: 14px 20px; border-radius: 8px; transition: .6s; color: white; font-weight: 600; }
</style>
</head>
<body>

<div id="toast"></div>
<h1>Manage Questions</h1>

<div class="container">

  <!-- Add Question -->
  <div class="card">
    <h2>Add New Question</h2>
    <label>Question Text:</label>
    <input type="text" id="questionText" placeholder="Enter question...">
    <button onclick="addQuestion()">Add Question</button>
  </div>

  <!-- Questions List -->
  <div class="card">
    <h2>All Questions</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Question</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="questionsTable"></tbody>
    </table>
  </div>

</div>

<script>
const API = "http://localhost:5000/api/question"; // Backend port 5000
const token = localStorage.getItem("token"); // Admin JWT token

function showToast(text, color="#22c55e") {
  const t = document.getElementById("toast");
  t.innerText = text;
  t.style.background = color;
  t.style.right = "20px";
  setTimeout(() => { t.style.right = "-300px"; }, 2000);
}

// Add Question
async function addQuestion() {
  const text = document.getElementById("questionText").value.trim();
  if(!text) return showToast("Question cannot be empty", "#ef4444");

  try {
    const res = await fetch(API, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      },
      body: JSON.stringify({ text })
    });

    const data = await res.json();

    if(res.ok) {
      showToast("Question added successfully!");
      document.getElementById("questionText").value = "";
      loadQuestions();
    } else {
      showToast(data.message || "Failed to add question", "#ef4444");
    }
  } catch (err) {
    console.error(err);
    showToast("Server error", "#ef4444");
  }
}

// Load all questions
async function loadQuestions() {
  try {
    const res = await fetch(API, {
      headers: { "Authorization": `Bearer ${token}` }
    });
    const questions = await res.json();
    const table = document.getElementById("questionsTable");
    table.innerHTML = "";

    questions.forEach(q => {
      table.innerHTML += `
        <tr>
          <td>${q.id}</td>
          <td><input id="q${q.id}" type="text" value="${q.text}" style="width: 95%"></td>
          <td>
            <button class="btn-small edit-btn" onclick="updateQuestion(${q.id})">Update</button>
            <button class="btn-small delete-btn" onclick="deleteQuestion(${q.id})">Delete</button>
          </td>
        </tr>
      `;
    });
  } catch (err) {
    console.error(err);
    showToast("Failed to load questions", "#ef4444");
  }
}

// Update question
async function updateQuestion(id) {
  const text = document.getElementById("q" + id).value.trim();
  if(!text) return showToast("Text cannot be empty", "#ef4444");

  try {
    const res = await fetch(`${API}/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
      body: JSON.stringify({ text })
    });

    const data = await res.json();
    if(res.ok) showToast("Question updated!");
    else showToast(data.message || "Update failed", "#ef4444");
    loadQuestions();
  } catch(err) {
    console.error(err);
    showToast("Server error", "#ef4444");
  }
}

// Delete question
async function deleteQuestion(id) {
  try {
    const res = await fetch(`${API}/${id}`, {
      method: "DELETE",
      headers: { "Authorization": `Bearer ${token}` }
    });

    if(res.ok) showToast("Deleted!", "#ef4444");
    else showToast("Failed to delete", "#ef4444");
    loadQuestions();
  } catch(err) {
    console.error(err);
    showToast("Server error", "#ef4444");
  }
}

// Load questions on page load
loadQuestions();
</script>
</body>
</html>
